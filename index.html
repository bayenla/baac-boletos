<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BAAC POWER UP - SORTEO LIFTING (App)</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --accent:#00cc44;
  --gold:#ffd700;
  --bg:#0a0a0a;
  --muted:#ccc;
  --text:#fff;
}

body{
  margin:0;
  font-family:"Poppins", sans-serif;
  background:#000;
  color:var(--text);
}

/* HEADER */
header{
  padding:20px;
  text-align:center;
  border-bottom:1px solid #222;
}
header h1{
  display:inline-block;
  font-size:32px;
  margin:0;
  padding:10px 18px;
  font-weight:900;
  color:var(--gold);
  letter-spacing:1px;
  border:2px solid var(--gold);
  border-radius:14px;
  text-shadow:0 0 10px rgba(255,215,0,0.6);
  box-shadow:0 0 12px rgba(255,215,0,0.25);
}

/* PANEL */
.panel{
  background:rgba(20,20,20,0.65);
  border:1px solid rgba(255,215,0,0.18);
  padding:25px;
  border-radius:20px;
  width:92%;
  margin:20px auto 10px;
}

.subtitulo{
  color:var(--gold);
  text-align:center;
  margin-bottom:8px;
  font-weight:600;
  font-size:15px;
}

/* DESCRIPCI√ìN */
.descripcion{
  text-align:center;
  color:#ddd;
  font-size:14px;
  margin-bottom:14px;
}

/* BLOQUES */
.flex-top{
  display:flex;
  justify-content:center;
  align-items:stretch;
  gap:25px;
  flex-wrap:wrap;
}

.box{
  background:#111;
  border:2px solid rgba(255,215,0,0.45);
  padding:18px 22px;
  border-radius:14px;
  width:260px;
  min-height:220px;
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  color:#fff;
  text-align:center;
}

.combos{
  display:flex;
  flex-direction:column;
  gap:8px;
}
.combo{
  background:#151515;
  border:1px solid rgba(255,215,0,0.35);
  padding:8px;
  border-radius:10px;
  font-size:15px;
  font-weight:600;
  color:#eee;
  cursor:pointer;
  transition:0.18s;
}
.combo:hover{ transform:scale(1.03); }
.combo.active{ background:#0b3; border-color:#079930; color:#002a00; }

/* cuenta */
.cuenta-box{
  font-size:15px;
  line-height:20px;
}
.cuenta-box b{
  color:var(--gold);
  font-size:16px;
}

/* form */
.form{
  display:flex;
  flex-direction:column;
  gap:14px;
  margin-top:14px;
}
.form input{
  background:#0b0b0b;
  border:2px solid transparent;
  padding:14px;
  border-radius:12px;
  color:#fff;
  font-size:16px;
  font-weight:600;
  outline:none;
  background-image:linear-gradient(#0b0b0b, #0b0b0b),
                    linear-gradient(90deg, #b8860b, #ffd700, #b8860b);
  background-origin:border-box;
  background-clip:padding-box, border-box;
}

/* CTA */
.cta{ margin-top:18px; text-align:center; }

.btn.primary{
  background:#111;
  color:#ffd700;
  border:2px solid #d4af37;
  padding:14px;
  font-size:17px;
  border-radius:14px;
  font-weight:700;
  width:100%;
  cursor:pointer;
  transition:0.3s;
  box-shadow:0 0 10px rgba(255,215,0,0.35);
}

.btn.primary:hover{
  transform:scale(1.06);
  box-shadow:0 0 18px rgba(255,215,0,0.7);
  background:#222;
}

/* N√öMEROS */
.numeros-section{
  width:92%;
  margin:10px auto 40px;
}

#contadorSeleccion{
  text-align:center;
  font-size:16px;
  font-weight:700;
  color:var(--gold);
  margin-bottom:10px;
  text-shadow:0 0 6px rgba(255,215,0,0.35);
}

#tabla{
  display:grid;
  grid-template-columns:repeat(10, 1fr);
  gap:4px;
  margin-top:10px;
  max-height:520px;
  overflow:auto;
  padding:8px;
  border-radius:10px;
  background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
}

#tabla div{
  background:#111;
  border:1px solid #333;
  padding:8px 0;
  text-align:center;
  border-radius:8px;
  cursor:default;
  font-weight:600;
  color:#fff;
  transition:0.12s;
  font-size:13px;
}

#tabla div:hover{
  transform:translateY(-2px);
  border-color:var(--accent);
}

/* ESTADOS */
.estado-disponible{
  background:#111;
  color:#fff;
}
.estado-ocupado{
  background:#ff0000 !important;   /* üî• Fondo rojo fuerte s√≥lido */
  border:2px solid #aa0000;        /* Borde rojo oscuro */
  color:#fff;                      /* Texto blanco para buen contraste */
  font-weight:900;
  text-decoration: line-through;   /* Tachado */
  box-shadow:0 0 10px #ff0000aa;   /* Glow rojo */

  animation:
    parpadeoOcupado 1.4s infinite ease-in-out,
    latidoOcupado 1.8s infinite ease-in-out;
}
.estado-asignado{
  background:#00cc44;
  border-color:#009933;
  color:#001b00;
  font-weight:800;
}

/* ASIGNADOS */
#listaAsignados{
  margin-top:12px;
  text-align:center;
  color:var(--gold);
  font-weight:700;
  display:none;
}
#msgError{ display:none; margin-top:10px; color:#ff4444; font-weight:700; text-align:center; font-size:15px; }
</style>
</head>

<body>

<header>
  <h1>BAAC POWER UP - SORTEO LIFTING</h1>
</header>

<div class="panel">

  <div class="subtitulo">Combos para jugar a tu estilo por 0,50 ctvs</div>

  <div class="descripcion">
    <div>La selecci√≥n es autom√°tica: el sistema asigna los n√∫meros de manera aleatoria <strong>al momento de registrar</strong>.</div>
    <div style="font-size:13px;color:#bbb;margin-top:6px;">Puedes visualizar abajo qu√© n√∫meros ya est√°n asignados (marcados en rojo) y cu√°les est√°n disponibles.</div>
  </div>

  <div class="flex-top">

    <div class="box">
      <div class="combos">
        <div class="combo" data-cant="2">üéüÔ∏è 2 boletos x $1</div>
        <div class="combo" data-cant="4">üéüÔ∏è 4 boletos x $2</div>
        <div class="combo" data-cant="6">üéüÔ∏è 6 boletos x $3</div>
        <div class="combo" data-cant="10">üéüÔ∏è 10 boletos x $5</div>
      </div>
    </div>

    <div class="box cuenta-box">
      <div><b>Cuenta de Ahorros:</b> 2200871074</div>
      <div>Banco Pichincha ¬∑ Titular:<br><b>Bryan Arturo Ayenla</b></div>
    </div>

  </div>

  <div id="listaAsignados">üéüÔ∏è Boletos asignados: <span id="asignadosText"></span></div>

  <div class="form">
    <input type="text" id="nombre" placeholder="Nombre completo">
    <input type="tel" id="telefono" placeholder="Tel√©fono">
    <input type="email" id="correo" placeholder="Correo">
  </div>

  <div class="cta">
    <button id="btnRegistrar" class="btn primary">REGISTRAR</button>

<div style="text-align:center; margin-top:25px;">
  <a href="https://www.tiktok.com/@arturbaac" target="_blank"
     style="
        display:inline-block;
        background:linear-gradient(90deg, #d4af37, #ffd700);
        padding:12px 24px;
        border-radius:14px;
        color:#000;
        font-weight:700;
        font-size:16px;
        text-decoration:none;
        font-family:'Poppins', sans-serif;
        box-shadow:0 0 12px #d4af37;
        transition:all 0.3s ease;
        animation:pulse 2s infinite;
     "
     onmouseover="this.style.transform='scale(1.08)'; this.style.boxShadow='0 0 18px #ffea80';"
     onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 0 12px #d4af37';"
  >
    üéµ S√≠gueme en TikTok: <strong>@arturbaac</strong>
  </a>
</div>

<style>
@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.04); }
  100% { transform: scale(1); }
}
</style>


    <div id="msgError"></div>
  </div>

</div>

<div class="numeros-section">

  <div id="contadorSeleccion">Disponibles: 0</div>
  <div id="tabla"></div>
</div>

<script>
/*
  Comportamiento:
  - Visualiza 1..1000 con estados: disponible / ocupado.
  - Usuario selecciona combo (cantidad).
  - Al presionar REGISTRAR:
      1) Se valida formulario y combo.
      2) Se recargan ocupados (√∫ltima verificaci√≥n).
      3) Se generan aleatoriamente N n√∫meros libres.
      4) Se env√≠an al WebApp (POST) junto a datos.
      5) Si respuesta ok: se muestran los n√∫meros asignados y se refresca la cuadr√≠cula.
*/

const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbxbyYd8N06UI-2OW8ZId3q6ZF2JZGhr4qlf9rLU2CNODqL6o06Il8EQJezpP84EeAVdyQ/exec"; // reemplaza si necesitas

const tabla = document.getElementById("tabla");
const contador = document.getElementById("contadorSeleccion");
const listaAsignados = document.getElementById("listaAsignados");
const asignadosText = document.getElementById("asignadosText");
const msgError = document.getElementById("msgError");
const btnRegistrar = document.getElementById("btnRegistrar");

let ocupadosGlobal = [];
let cantidadElegida = 0;
let asignadosTemp = [];

// obtener ocupados del servidor
async function cargarOcupados(){
  try{
    const res = await fetch(WEBAPP_URL + "?action=getOcupados");
    const data = await res.json();
    ocupadosGlobal = data.ocupados || [];
    return ocupadosGlobal;
  } catch(e){
    console.error("Error cargando ocupados", e);
    ocupadosGlobal = [];
    return ocupadosGlobal;
  }
}

// pintar la tabla 1..1000
async function generarTabla(){
  tabla.innerHTML = "";
  listaAsignados.style.display = "none";
  asignadosText.textContent = "";
  asignadosTemp = [];

  const ocupados = await cargarOcupados();
  const disponiblesCount = 1000 - (ocupados.length || 0);
  contador.textContent = `Disponibles: ${disponiblesCount}`;

  const fragment = document.createDocumentFragment();

  for(let i=1;i<=1000;i++){
    const celda = document.createElement("div");
    celda.textContent = i;
    if(ocupados.includes(i)){
      celda.classList.add("estado-ocupado");
      celda.title = "Ocupado";
    } else {
      celda.classList.add("estado-disponible");
      celda.title = "Disponible";
    }
    fragment.appendChild(celda);
  }

  tabla.appendChild(fragment);
}

// manejador combos
document.querySelectorAll(".combo").forEach(c=>{
  c.addEventListener("click", ()=>{
    document.querySelectorAll(".combo").forEach(x=>x.classList.remove("active"));
    c.classList.add("active");
    cantidadElegida = parseInt(c.dataset.cant, 10);
    msgError.style.display = "none";
    listaAsignados.style.display = "none";
    asignadosText.textContent = "";
  });
});

// shuffle parcial / generaci√≥n
function generarAleatorios(cant, ocupados){
  const libres = [];
  for(let i=1;i<=1000;i++){
    if(!ocupados.includes(i)) libres.push(i);
  }
  if(libres.length < cant) return null;

  // Fisher-Yates shuffle
  for (let i = libres.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [libres[i], libres[j]] = [libres[j], libres[i]];
  }

  return libres.slice(0, cant);
}

// registrar: generar aleatorios y enviar al servidor (solo al registrar)
btnRegistrar.addEventListener("click", async ()=>{

  const nombre = document.getElementById("nombre").value.trim();
  const telefono = document.getElementById("telefono").value.trim();
  const correo = document.getElementById("correo").value.trim();

  if(!cantidadElegida || cantidadElegida <= 0){
    msgError.textContent = "‚ö† Selecciona un combo primero.";
    msgError.style.display = "block";
    return;
  }
  if(!nombre || !telefono || !correo){
    msgError.textContent = "‚ö† Completa todos los datos.";
    msgError.style.display = "block";
    return;
  }

  msgError.style.display = "none";

  // bloqueo UI
  btnRegistrar.textContent = "Asignando y registrando...";
  btnRegistrar.disabled = true;

  // √∫ltima verificaci√≥n de ocupados
  await cargarOcupados();

  const numeros = generarAleatorios(cantidadElegida, ocupadosGlobal);
  if(!numeros){
    alert("Lo siento ‚Äî ya no hay suficientes n√∫meros libres. Actualiza la p√°gina y prueba otro combo.");
    btnRegistrar.textContent = "REGISTRAR";
    btnRegistrar.disabled = false;
    await generarTabla();
    return;
  }

  // enviar al servidor
  try{
    const formData = new FormData();
    formData.append("nombre", nombre);
    formData.append("telefono", telefono);
    formData.append("correo", correo);
    formData.append("boletos", numeros.join(","));

    const res = await fetch(WEBAPP_URL, { method: "POST", body: formData });
    const data = await res.json();

    if(data && data.status === "ok"){
      // mostrar asignados
      asignadosTemp = numeros.slice();
      asignadosText.textContent = asignadosTemp.join(" ¬∑ ");
      listaAsignados.style.display = "block";

      alert("üéâ Registro guardado correctamente!\nTus n√∫meros: " + asignadosTemp.join(", "));

      // limpiar formulario y combo
      document.getElementById("nombre").value = "";
      document.getElementById("telefono").value = "";
      document.getElementById("correo").value = "";
      cantidadElegida = 0;
      document.querySelectorAll(".combo").forEach(x=>x.classList.remove("active"));

      // refrescar tabla para mostrar los ocupados actualizados
      await generarTabla();
    } else {
      const ms = data && data.message ? data.message : "Respuesta inesperada del servidor.";
      alert("Error guardando: " + ms);
    }
  } catch(err){
    console.error(err);
    alert("Error de conexi√≥n al intentar registrar. Intenta de nuevo.");
  }

  btnRegistrar.textContent = "REGISTRAR";
  btnRegistrar.disabled = false;
});

// inicio
generarTabla();

</script>
</body>
</html>
